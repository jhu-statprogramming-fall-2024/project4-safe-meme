---
title: "Final Model"
echo: false
warning: false
message: false
---

We decide to run a time series multiple linear regression model to predict the NDVI of cropland in Illinois over time using the climate variables. To do this we use the library fable that allows us to run the model from a tsibble (a tibble with a time series component). We train the model on the data from 2000 to 2020 and then use the model to predict NDVI for the years 2021 to 2024. We then create the following plot to compare the actual data to the predicted confidence intervals.

```{r}
combined_dataset <- read.csv("Data_new/combined_dataset.csv")
```

```{r, fig.width=18}
library(forecast)
library(fpp3)
library(tsibbledata)
library(tsibble)
library(fable)

modified_ts <- tsibble(
  date = as.Date(combined_dataset$date),
  NDVI = combined_dataset$NDVI,
  swe = combined_dataset$swe,
  EVI = combined_dataset$EVI,
  LAI = combined_dataset$LAI,
  prcp = combined_dataset$prcp,
  PET = combined_dataset$PET,
  tmax = combined_dataset$tmax,
  tmin = combined_dataset$tmin,
  vp = combined_dataset$vp,
  FPAR = combined_dataset$FPAR,
  ET = combined_dataset$ET,
  PLE = combined_dataset$PLE,
  dayl = combined_dataset$dayl,
)

train <- modified_ts %>% filter_index(~ "2019-12-27")
test <- modified_ts %>% filter_index("2020-01-03" ~.)

fit_one <- train %>% model(TSLM(NDVI ~ swe + prcp + PET + tmax + tmin + vp + FPAR + ET + PLE + dayl))

forecast_test <- forecast(fit_one, new_data = test)
forecast_test %>% autoplot(modified_ts) + theme_bw() + labs(title = "NDVI over time", x = "Date")

```
This plot shows the true NDVI value from 2000 to 2024 and the confidence interval for our prediction from 2020 to 2024 in purple.

```{r}
forecast_test <- forecast(fit_one, new_data = test)
forecast_test %>% autoplot()+ theme_bw() + labs(title = "NDVI prediction over time", x="Date")
```

This plot shows our prediction of NDVI from 2020 to 2024 and a confidence interval around the prediction.


